<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receive Notification</title>
</head>
<body>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";
    import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-messaging.js";

    // Firebase-Konfiguration
    const firebaseConfig = {
        apiKey: "AIzaSyC9fRuO8kTd5ttT5pu-dlsO157DY_H7NgE",
        authDomain: "pushcoal-745bc.firebaseapp.com",
        databaseURL: "https://pushcoal-745bc-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "pushcoal-745bc",
        storageBucket: "pushcoal-745bc.firebasestorage.app",
        messagingSenderId: "592638766918",
        appId: "1:592638766918:web:10a98c5f87a563c9823f47",
        measurementId: "G-W16QRE2BFL"
    };

    // Firebase initialisieren
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Firebase Cloud Messaging initialisieren
    const messaging = getMessaging(app);

    // Funktion zum Anfordern eines Tokens für Push-Benachrichtigungen
    async function requestNotificationPermission() {
        try {
            const token = await getToken(messaging, {
                vapidKey: 'BN_MNDUC1TvmMbpLM1SvaIPR4HtL8MDqPGdkoSZQTfemjBvJ7P_AU-Aup4O496Ti5eV79Ncu6kBBhOSMxIJSdvA'  // Dein VAPID-Schlüssel hier einfügen
            });
            console.log('Token erhalten:', token);
        } catch (error) {
            console.error('Fehler beim Abrufen des Tokens:', error);
        }
    }

    // Auf Firebase-Datenbank überwachen
    const notificationRef = ref(db, 'notifications');
    onValue(notificationRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
            // Wenn eine Nachricht empfangen wurde, zeige eine Push-Benachrichtigung
            const message = data.message || 'Keine Nachricht';
            const timestamp = data.timestamp || 'Unbekannt';

            // Browser-Push-Benachrichtigung anzeigen
            if (Notification.permission === "granted") {
                new Notification("Neue Benachrichtigung", {
                    body: `Nachricht: ${message}\nZeit: ${timestamp}`,
                    icon: 'https://example.com/icon.png'  // Optional: füge ein Icon hinzu
                });
            }
        }
    });

    // Benachrichtigungsberechtigung anfordern
    if (Notification.permission !== "granted") {
        Notification.requestPermission().then((permission) => {
            if (permission === "granted") {
                requestNotificationPermission();
            } else {
                console.log('Benachrichtigungen abgelehnt');
            }
        });
    }
</script>

<h1>Notification Empfänger</h1>
<p>Warten auf Benachrichtigungen...</p>

</body>
</html>


   
