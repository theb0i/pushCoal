<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receive Notification</title>
</head>
<body>

<script type="module">
    // Firebase initialisieren
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";
    import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-messaging.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC9fRuO8kTd5ttT5pu-dlsO157DY_H7NgE",
        authDomain: "pushcoal-745bc.firebaseapp.com",
        databaseURL: "https://pushcoal-745bc-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "pushcoal-745bc",
        storageBucket: "pushcoal-745bc.firebasestorage.app",
        messagingSenderId: "592638766918",
        appId: "1:592638766918:web:10a98c5f87a563c9823f47",
        measurementId: "G-W16QRE2BFL"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const messaging = getMessaging(app);

    // Firebase-Messaging Token abrufen (nur einmalig)
    getToken(messaging, { vapidKey: 'YOUR_PUBLIC_VAPID_KEY' }).then((currentToken) => {
        if (currentToken) {
            console.log("Token erhalten: ", currentToken);
        } else {
            console.log("Kein Token erhalten.");
        }
    }).catch((error) => {
        console.error('Token Error:', error);
    });

    // Push-Benachrichtigung, wenn eine neue Nachricht in der Datenbank erscheint
    onValue(ref(db, 'notifications'), (snapshot) => {
        const data = snapshot.val();
        if (data) {
            showPushNotification(data.message);
        }
    });

    // Zeigt die Push-Benachrichtigung
    function showPushNotification(message) {
        if (Notification.permission === 'granted') {
            new Notification('Neue Nachricht: ' + message);
        }
    }

    // Berechtigung fÃ¼r Push-Benachrichtigungen anfragen
    if (Notification.permission !== 'granted') {
        Notification.requestPermission().then(permission => {
            if (permission === 'granted') {
                console.log('Push-Benachrichtigungen erlaubt.');
            }
        });
    }

    // Beim Empfang von Nachrichten in der App (z.B. im Hintergrund)
    onMessage(messaging, (payload) => {
        console.log('Nachricht empfangen:', payload);
        new Notification(payload.notification.title, {
            body: payload.notification.body
        });
    });
</script>

<h1>Waiting for Notifications...</h1>

</body>
</html>
