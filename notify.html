<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receive Notification</title>
    <style>
        /* CSS-Animation für den Hintergrundwechsel */
        @keyframes flashBackground {
            0% { background-color: white; }
            33% { background-color: black; }
            66% { background-color: white; }
            100% { background-color: black; }
        }

        /* Stil für die Benachrichtigung */
        #notification {
            font-size: 30px;
            font-weight: bold;
            color: red;
            display: none; /* Anfangs unsichtbar */
            padding: 20px;
            border: 2px solid red;
            text-align: center;
            margin-top: 20px;
        }

        .flashing {
            animation: flashBackground 0.3s 3;
        }

        /* Stil für das Ausrufezeichen und die Tabelle */
        .notification-item {
            font-size: 25px;
            color: red;
            padding: 10px;
            border: 2px solid red;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .flashed {
            animation: flashBackground 0.3s 3;
        }

        #tableNumber {
            font-size: 50px;
            color: red;
        }

        #timestamp {
            font-size: 20px;
            margin-top: 10px;
        }

        /* Um neue Benachrichtigungen unter der alten hinzuzufügen */
        #notifications-list {
            margin-top: 20px;
        }

        .completed {
            background-color: green !important;
        }
    </style>
</head>
<body>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

    // Firebase-Konfiguration
    const firebaseConfig = {
        apiKey: "AIzaSyC9fRuO8kTd5ttT5pu-dlsO157DY_H7NgE",
        authDomain: "pushcoal-745bc.firebaseapp.com",
        databaseURL: "https://pushcoal-745bc-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "pushcoal-745bc",
        storageBucket: "pushcoal-745bc.firebasestorage.app",
        messagingSenderId: "592638766918",
        appId: "1:592638766918:web:10a98c5f87a563c9823f47",
        measurementId: "G-W16QRE2BFL"
    };

    // Firebase initialisieren
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Funktion, die Benachrichtigung anzeigt
    function showNotification(message, tableNumber, timestamp) {
        // Neue Benachrichtigung erstellen
        const notificationsList = document.getElementById('notifications-list');

        // Neues Benachrichtigungs-Div erstellen
        const newNotification = document.createElement('div');
        newNotification.classList.add('notification-item');

        // Inhalt der Benachrichtigung
        newNotification.innerHTML = `
            <div id="tableNumber">⚠️ Tisch: ${tableNumber}</div>
            <div id="message">Neue Kohle: ${message}</div>
            <div id="timestamp">Zeit: ${timestamp}</div>
        `;

        // Benachrichtigung zur Liste hinzufügen
        notificationsList.prepend(newNotification);

        // Hintergrundanimation starten
        newNotification.classList.add('flashing');

        // Alle 30 Sekunden den Flash-Effekt wiederholen, wenn die Benachrichtigung noch nicht angeklickt wurde
        const flashInterval = setInterval(() => {
            if (!newNotification.classList.contains('completed')) {
                newNotification.classList.add('flashed');
                setTimeout(() => newNotification.classList.remove('flashed'), 300); // Flash für 0.3s
            } else {
                clearInterval(flashInterval); // Stoppt das Flashen, wenn angeklickt
            }
        }, 30000); // Alle 30 Sekunden

        // Klick-Event für die Benachrichtigung
        newNotification.addEventListener('click', () => {
            newNotification.classList.add('completed'); // Verändert den Hintergrund zu grün
            newNotification.style.backgroundColor = 'green';
            clearInterval(flashInterval); // Stoppt das Flashen, wenn angeklickt
        });
    }

    // Firebase-Datenbank überwachen
    const notificationRef = ref(db, 'notifications');
    onValue(notificationRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
            const message = data.message || 'Keine Nachricht';
            const tableNumber = data.tableNumber || 'Unbekannt';
            const timestamp = data.timestamp || 'Unbekannt';

            // Zeige die Benachrichtigung und starte die Animation
            showNotification(message, tableNumber, timestamp);
        }
    });
</script>

<h1>Empfänger für Benachrichtigungen</h1>

<!-- Liste der Benachrichtigungen -->
<div id="notifications-list"></div>

</body>
</html>
